name: Automated Blog Post Generator

# Runs 3 times per day: 6 AM, 2 PM, and 10 PM UTC
# You can adjust these times as needed
on:
  schedule:
    # 6:00 AM UTC (adjust timezone as needed)
    - cron: '0 6 * * *'
    # 2:00 PM UTC
    - cron: '0 14 * * *'
    # 10:00 PM UTC
    - cron: '0 22 * * *'
  workflow_dispatch: # Allows manual triggering for testing

jobs:
  generate-post:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“¦ Install dependencies
        run: npm install

      - name: ðŸ“ Generate blog post
        id: generate
        run: |
          echo "ðŸš€ Starting post generation..."
          node scripts/generatePost.js
          echo "âœ… Post generation completed"
        continue-on-error: false

      - name: ðŸ’¾ Commit and push changes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          # Check if there are changes to commit
          if [ -n "$(git status --porcelain)" ]; then
            echo "ðŸ“ Changes detected, committing..."
            git add posts/*.md
            git commit -m "ðŸ¤– Auto-generated blog post [skip ci]"
            git push origin HEAD:main
            echo "âœ… Changes pushed successfully"
          else
            echo "â„¹ï¸  No new posts to commit (may be duplicate or error)"
          fi

      - name: ðŸ“Š Post generation summary
        run: |
          echo "### âœ… Automated Post Generation Complete" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Status:** Success" >> $GITHUB_STEP_SUMMARY
          echo "**Time:** $(date)" >> $GITHUB_STEP_SUMMARY
          echo "**Repository:** ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "New markdown files will trigger Vercel deployment automatically." >> $GITHUB_STEP_SUMMARY

